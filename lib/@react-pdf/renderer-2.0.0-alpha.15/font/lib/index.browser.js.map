{"version":3,"file":"index.browser.js","sources":["../src/font.js","../src/standard.js","../src/index.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\n\nimport isUrl from 'is-url';\nimport fetch from 'cross-fetch';\nimport fontkit from '@react-pdf/fontkit';\n\nconst fetchFont = async (src, options) => {\n  const response = await fetch(src, options);\n\n  const buffer = await (response.buffer\n    ? response.buffer()\n    : response.arrayBuffer());\n\n  return buffer.constructor.name === 'Buffer' ? buffer : Buffer.from(buffer);\n};\n\nconst isDataUrl = dataUrl => {\n  const header = dataUrl.split(',')[0];\n  const hasDataPrefix = header.substring(0, 5) === 'data:';\n  const hasBase64Prefix = header.split(';')[1] === 'base64';\n\n  return hasDataPrefix && hasBase64Prefix;\n};\n\nclass FontSource {\n  constructor(src, fontFamily, fontStyle, fontWeight, options) {\n    this.src = src;\n    this.fontFamily = fontFamily;\n    this.fontStyle = fontStyle || 'normal';\n    this.fontWeight = 400;\n\n    this.data = null;\n    this.loading = false;\n    this.options = options;\n  }\n\n  async load() {\n    this.loading = true;\n\n    if (isDataUrl(this.src)) {\n      this.data = fontkit.create(Buffer.from(this.src.split(',')[1], 'base64'));\n    } else if (BROWSER || isUrl(this.src)) {\n      const { headers, body, method = 'GET' } = this.options;\n      const data = await fetchFont(this.src, { method, body, headers });\n      this.data = fontkit.create(data);\n      this.loading = false;\n    } else {\n      this.data = await new Promise((resolve, reject) =>\n        fontkit.open(this.src, (err, data) => {\n          this.loading = false;\n          return err ? reject(err) : resolve(data);\n        }),\n      );\n    }\n  }\n}\n\nclass Font {\n  static create(family) {\n    return new Font(family);\n  }\n\n  constructor(family) {\n    this.family = family;\n    this.sources = [];\n  }\n\n  register({ src, fontWeight, fontStyle, ...options }) {\n    this.sources.push(\n      new FontSource(src, this.fontFamily, fontStyle, fontWeight, options),\n    );\n  }\n\n  resolve(descriptor) {\n    const { fontWeight = 400, fontStyle = 'normal' } = descriptor;\n    const styleSources = this.sources.filter(s => s.fontStyle === fontStyle);\n\n    // Weight resolution. https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight#Fallback_weights\n    const exactFit = styleSources.find(s => s.fontWeight === fontWeight);\n\n    if (exactFit) return exactFit;\n\n    let res;\n\n    if (fontWeight >= 400 && fontWeight <= 500) {\n      const leftOffset = styleSources.filter(s => s.fontWeight <= fontWeight);\n      const rightOffset = styleSources.filter(s => s.fontWeight > 500);\n      const fit = styleSources.filter(\n        s => s.fontWeight >= fontWeight && s.fontWeight < 500,\n      );\n\n      res = fit[0] || leftOffset[leftOffset.length - 1] || rightOffset[0];\n    }\n\n    const lt = styleSources.filter(s => s.fontWeight < fontWeight);\n    const gt = styleSources.filter(s => s.fontWeight > fontWeight);\n\n    if (fontWeight < 400) {\n      res = lt[lt.length - 1] || gt[0];\n    }\n\n    if (fontWeight > 500) {\n      res = gt[0] || lt[lt.length - 1];\n    }\n\n    if (!res) {\n      throw new Error(\n        `Could not resolve font for ${this.fontFamily}, fontWeight ${fontWeight}`,\n      );\n    }\n\n    return res;\n  }\n}\n\nexport default Font;\n","export default [\n  'Courier',\n  'Courier-Bold',\n  'Courier-Oblique',\n  'Helvetica',\n  'Helvetica-Bold',\n  'Helvetica-Oblique',\n  'Times-Roman',\n  'Times-Bold',\n  'Times-Italic',\n];\n","import font from './font';\nimport standard from './standard';\n\nfunction FontStore() {\n  let fonts = {};\n\n  let emojiSource = null;\n\n  let hyphenationCallback = null;\n\n  this.register = data => {\n    const { family } = data;\n\n    if (!fonts[family]) {\n      fonts[family] = font.create(family);\n    }\n\n    // Bulk loading\n    if (data.fonts) {\n      for (let i = 0; i < data.fonts.length; i += 1) {\n        fonts[family].register({ family, ...data.fonts[i] });\n      }\n    } else {\n      fonts[family].register(data);\n    }\n  };\n\n  this.registerEmojiSource = ({ url, format = 'png' }) => {\n    emojiSource = { url, format };\n  };\n\n  this.registerHyphenationCallback = callback => {\n    hyphenationCallback = callback;\n  };\n\n  this.getFont = descriptor => {\n    const { fontFamily } = descriptor;\n    const isStandard = standard.includes(fontFamily);\n\n    if (isStandard) return null;\n\n    if (!fonts[fontFamily]) {\n      throw new Error(\n        `Font family not registered: ${fontFamily}. Please register it calling Font.register() method.`,\n      );\n    }\n\n    return fonts[fontFamily].resolve(descriptor);\n  };\n\n  this.load = async descriptor => {\n    const { fontFamily } = descriptor;\n    const isStandard = standard.includes(fontFamily);\n\n    if (isStandard) return;\n\n    const f = this.getFont(descriptor);\n\n    // We cache the font to avoid fetching it many times\n    if (!f.data && !f.loading) {\n      await f.load();\n    }\n  };\n\n  this.reset = () => {\n    const keys = Object.keys(fonts);\n\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      fonts[key].data = null;\n    }\n  };\n\n  this.clear = () => {\n    fonts = {};\n  };\n\n  this.getRegisteredFonts = () => fonts;\n\n  this.getEmojiSource = () => emojiSource;\n\n  this.getHyphenationCallback = () => hyphenationCallback;\n\n  this.getRegisteredFontFamilies = () => Object.keys(fonts);\n}\n\nexport default FontStore;\n"],"names":["fetchFont","src","options","fetch","response","buffer","arrayBuffer","constructor","name","Buffer","from","isDataUrl","dataUrl","header","split","hasDataPrefix","substring","hasBase64Prefix","FontSource","fontFamily","fontStyle","fontWeight","data","loading","load","fontkit","create","headers","body","method","Promise","resolve","reject","open","err","Font","family","sources","register","push","descriptor","styleSources","filter","s","exactFit","find","res","leftOffset","rightOffset","fit","length","lt","gt","Error","FontStore","fonts","emojiSource","hyphenationCallback","font","i","registerEmojiSource","url","format","registerHyphenationCallback","callback","getFont","isStandard","standard","includes","f","reset","keys","Object","key","clear","getRegisteredFonts","getEmojiSource","getHyphenationCallback","getRegisteredFontFamilies"],"mappings":"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"}