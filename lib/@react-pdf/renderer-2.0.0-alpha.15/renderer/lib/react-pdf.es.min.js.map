{"version":3,"file":"react-pdf.es.min.js","sources":["../src/propsEqual.js","../src/renderer.js","../src/index.js","../src/node.js"],"sourcesContent":["/* eslint-disable no-continue */\n\n/**\n * Checks if two sets of props are equal (recursively)\n *\n * @param {Object} props A\n * @param {Object} props B\n * @returns {Boolean} props equals?\n *\n */\nconst propsEqual = (a, b) => {\n  const oldPropsKeys = Object.keys(a);\n  const newPropsKeys = Object.keys(b);\n\n  if (oldPropsKeys.length !== newPropsKeys.length) {\n    return false;\n  }\n\n  for (let i = 0; i < oldPropsKeys.length; i += 1) {\n    const propName = oldPropsKeys[i];\n\n    if (propName === 'render' && !a[propName] !== !b[propName]) {\n      return false;\n    }\n\n    if (propName !== 'children' && a[propName] !== b[propName]) {\n      if (\n        typeof a[propName] === 'object' &&\n        typeof b[propName] === 'object' &&\n        propsEqual(a[propName], b[propName])\n      ) {\n        continue;\n      }\n\n      return false;\n    }\n\n    if (\n      propName === 'children' &&\n      (typeof a[propName] === 'string' || typeof b[propName] === 'string')\n    ) {\n      return a[propName] === b[propName];\n    }\n  }\n\n  return true;\n};\n\nexport default propsEqual;\n","/* eslint-disable no-unused-vars */\n/* eslint-disable no-param-reassign */\n\nimport ReactFiberReconciler from 'react-reconciler';\nimport {\n  unstable_scheduleCallback as schedulePassiveEffects,\n  unstable_cancelCallback as cancelPassiveEffects,\n} from 'scheduler';\n\nimport propsEqual from './propsEqual';\n\nconst emptyObject = {};\n\nconst createRenderer = ({ onChange = () => {} }) => {\n  return ReactFiberReconciler({\n    schedulePassiveEffects,\n\n    cancelPassiveEffects,\n\n    supportsMutation: true,\n\n    isPrimaryRenderer: false,\n\n    warnsIfNotActing: false,\n\n    appendInitialChild(parentInstance, child) {\n      parentInstance.children.push(child);\n    },\n\n    createInstance(type, { style, children, ...props }) {\n      return {\n        type,\n        box: {},\n        style: style || {},\n        props: props || {},\n        children: [],\n      };\n    },\n\n    createTextInstance(text, rootContainerInstance) {\n      return { type: 'TEXT_INSTANCE', value: text };\n    },\n\n    finalizeInitialChildren(element, type, props) {\n      return false;\n    },\n\n    getPublicInstance(instance) {\n      return instance;\n    },\n\n    prepareForCommit() {\n      // Noop\n    },\n\n    prepareUpdate(element, type, oldProps, newProps) {\n      return !propsEqual(oldProps, newProps);\n    },\n\n    resetAfterCommit: onChange,\n\n    resetTextContent(element) {\n      // Noop\n    },\n\n    getRootHostContext() {\n      return emptyObject;\n    },\n\n    getChildHostContext() {\n      return emptyObject;\n    },\n\n    shouldSetTextContent(type, props) {\n      return false;\n    },\n\n    now: Date.now,\n\n    useSyncScheduling: true,\n\n    appendChild(parentInstance, child) {\n      parentInstance.children.push(child);\n    },\n\n    appendChildToContainer(parentInstance, child) {\n      if (parentInstance.type === 'ROOT') {\n        parentInstance.document = child;\n      } else {\n        parentInstance.children.push(child);\n      }\n    },\n\n    insertBefore(parentInstance, child, beforeChild) {\n      const index = parentInstance.children.indexOf(beforeChild);\n      if (index !== -1 && child)\n        parentInstance.children.splice(index, 0, child);\n    },\n\n    removeChild(parentInstance, child) {\n      const index = parentInstance.children.indexOf(child);\n      if (index !== -1) parentInstance.children.splice(index, 1);\n    },\n\n    removeChildFromContainer(parentInstance, child) {\n      const index = parentInstance.children.indexOf(child);\n      if (index !== -1) parentInstance.children.splice(index, 1);\n    },\n\n    commitTextUpdate(textInstance, oldText, newText) {\n      textInstance.value = newText;\n    },\n\n    commitUpdate(instance, updatePayload, type, oldProps, newProps) {\n      const { style, ...props } = newProps;\n      instance.props = props;\n      instance.style = style;\n    },\n  });\n};\n\nexport default createRenderer;\n","import BlobStream from 'blob-stream';\nimport FontStore from '@react-pdf/font';\nimport renderPDF from '@react-pdf/render';\nimport PDFDocument from '@react-pdf/pdfkit';\nimport layoutDocument from '@react-pdf/layout';\n\nimport createRenderer from './renderer';\nimport { version } from '../package.json';\n\nconst fontStore = new FontStore();\n\nconst pdf = ({ initialValue, onChange }) => {\n  const container = { type: 'ROOT', document: null, lang: 'en-US' };\n  const PDFRenderer = createRenderer({ onChange });\n  const mountNode = PDFRenderer.createContainer(container);\n\n  const updateContainer = doc => {\n    PDFRenderer.updateContainer(doc, mountNode, null);\n  };\n\n  if (initialValue) updateContainer(initialValue);\n\n  const getLang = () => {\n    const { document } = container\n    return document.props ? document.props.lang : null\n  }\n\n  const render = async () => {\n    const ctx = new PDFDocument({ autoFirstPage: false, lang: getLang() });\n    const layout = await layoutDocument(container.document, fontStore);\n\n    return renderPDF(ctx, layout);\n  };\n\n  const callOnRender = (params = {}) => {\n    if (container.document.props.onRender) {\n      container.document.props.onRender(params);\n    }\n  };\n\n  const toBlob = async () => {\n    const instance = await render();\n    const stream = instance.pipe(BlobStream());\n\n    return new Promise((resolve, reject) => {\n      stream.on('finish', () => {\n        try {\n          const blob = stream.toBlob('application/pdf');\n          callOnRender({ blob });\n          resolve(blob);\n        } catch (error) {\n          reject(error);\n        }\n      });\n\n      stream.on('error', reject);\n    });\n  };\n\n  const toBuffer = async () => {\n    callOnRender();\n    return render();\n  };\n\n  const toString = async () => {\n    let result = '';\n    const instance = await render();\n\n    return new Promise((resolve, reject) => {\n      try {\n        instance.on('data', buffer => {\n          result += buffer;\n        });\n\n        instance.on('end', () => {\n          resolve(result);\n        });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  };\n\n  return {\n    container,\n    toBlob,\n    toBuffer,\n    toString,\n    updateContainer,\n  };\n};\n\nconst Font = fontStore;\n\nconst StyleSheet = {\n  create: s => s,\n};\n\nexport { version, Font, StyleSheet, pdf };\n","import fs from 'fs';\nimport * as primitives from '@react-pdf/primitives';\nimport { pdf, version, Font, StyleSheet } from './index';\n\nexport const renderToStream = async element => {\n  const instance = pdf({ initialValue: element });\n  const buffer = await instance.toBuffer();\n  return buffer;\n};\n\nexport const renderToString = element => {\n  const instance = pdf({ initialValue: element });\n  return instance.toString();\n};\n\nexport const renderToFile = async (element, filePath, callback) => {\n  const output = await renderToStream(element);\n  const stream = fs.createWriteStream(filePath);\n\n  output.pipe(stream);\n\n  return new Promise((resolve, reject) => {\n    stream.on('finish', () => {\n      if (callback) callback(output, filePath);\n      resolve(output);\n    });\n    stream.on('error', reject);\n  });\n};\n\nconst throwEnvironmentError = name => {\n  throw new Error(\n    `${name} is a web specific API. You're either using this component on Node, or your bundler is not loading react-pdf from the appropriate web build.`,\n  );\n};\n\nexport const PDFViewer = () => {\n  throwEnvironmentError('PDFViewer');\n};\n\nexport const PDFDownloadLink = () => {\n  throwEnvironmentError('PDFDownloadLink');\n};\n\nexport const BlobProvider = () => {\n  throwEnvironmentError('BlobProvider');\n};\n\nexport const render = renderToFile;\n\nexport * from './index';\n\nexport * from '@react-pdf/primitives';\n\nexport default {\n  pdf,\n  Font,\n  version,\n  StyleSheet,\n  PDFViewer,\n  BlobProvider,\n  PDFDownloadLink,\n  renderToStream,\n  renderToString,\n  renderToFile,\n  render,\n  ...primitives,\n};\n"],"names":["propsEqual","a","b","oldPropsKeys","Object","keys","newPropsKeys","length","i","propName","emptyObject","fontStore","FontStore","pdf","initialValue","onChange","container","type","document","lang","PDFRenderer","ReactFiberReconciler","schedulePassiveEffects","cancelPassiveEffects","supportsMutation","isPrimaryRenderer","warnsIfNotActing","appendInitialChild","parentInstance","child","children","push","createInstance","style","props","box","createTextInstance","text","rootContainerInstance","value","finalizeInitialChildren","element","getPublicInstance","instance","prepareForCommit","prepareUpdate","oldProps","newProps","resetAfterCommit","resetTextContent","getRootHostContext","getChildHostContext","shouldSetTextContent","now","Date","useSyncScheduling","appendChild","appendChildToContainer","insertBefore","beforeChild","index","indexOf","splice","removeChild","removeChildFromContainer","commitTextUpdate","textInstance","oldText","newText","commitUpdate","updatePayload","createRenderer","mountNode","createContainer","updateContainer","doc","getLang","render","async","ctx","PDFDocument","autoFirstPage","layout","layoutDocument","renderPDF","callOnRender","params","onRender","toBlob","stream","pipe","BlobStream","Promise","resolve","reject","on","blob","error","toBuffer","toString","result","buffer","Font","StyleSheet","create","s","renderToStream","renderToString","renderToFile","filePath","callback","output","fs","createWriteStream","throwEnvironmentError","name","Error","PDFViewer","PDFDownloadLink","BlobProvider","version","primitives"],"mappings":"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"}